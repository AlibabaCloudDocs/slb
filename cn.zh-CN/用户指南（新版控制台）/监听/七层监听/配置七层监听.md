# 配置七层监听 {#concept_r2k_z35_vdb .concept}

负载均衡支持创建七层HTTP和HTTPS协议监听。

## 七层监听概述 {#section_o1s_js5_vdb .section}

-   HTTP协议

    HTTP是应用层协议，主要解决如何包装数据。适用于需要对数据内容进行识别的应用，如Web应用、小的手机游戏等。

-   HTTPS协议

    HTTPS是以安全为目标的HTTP通道，即HTTP下加入SSL层来保证数据安全。负载均衡支持HTTPS单向和双向认证。提供证书管理功能，无需在后端服务器上进行证书配置，详情查看[配置HTTPS监听](cn.zh-CN/用户指南/监听/七层监听/HTTPS监听.md#)。


## 七层监听配置 {#section_ksl_rs5_vdb .section}

|监听配置|说明|
|:---|:-|
|**监听端口**|用来接收请求并向后端服务器进行请求转发的前端协议和端口。配置七层监听，协议选择HTTP或HTTPS，端口为1-65535。

**说明：** 在同一个负载均衡实例内前端端口不可重复。

|
|**默认服务器端口**|默认服务器（ECS实例）开放用来接收请求的后端端口。后端的协议类型为HTTP，端口为1-65535。

**说明：** 在同一个负载均衡实例内后端端口可重复。

|
|**带宽峰值**|对于按带宽计费的负载均衡实例，您可以针对不同监听设定不同的带宽峰值来限定监听的流量。实例下所有监听的带宽峰值总和不能超过该实例的带宽。当不限制监听带宽时，各监听共享实例的总带宽。更多详细信息，参考[共享实例带宽](cn.zh-CN/用户指南/监听/共享实例带宽.md#)。

|
|**调度算法**|负载均衡支持轮询、加权轮询（WRR）、加权最小连接数（WLC）三种调度算法。-   轮询：按照访问顺序依次将外部请求依序分发到后端服务器。
-   加权轮询：权重值越高的后端服务器，被轮询到的次数（概率）也越高。
-   加权最小连接数：除了根据每台后端服务器设定的权重值来进行轮询，同时还考虑后端服务器的实际负载（即连接数）。当权重值相同时，当前连接数越小的后端服务器被轮询到的次数（概率）也越高。

|
|**默认服务器组**|一组接收前端请求的ECS实例。您可以单独添加ECS实例到服务器池，也可以通过虚拟服务器组或主备服务器组来批量添加和管理。|
|**虚拟服务器组**|一个虚拟服务器组（VServer group）由多个后端服务器组成，且后端服务器的端口可以不同。您可以为不同的监听配置不同的虚拟服务器组，这样就可以将请求转发至不同的后端服务器。详情参考[创建虚拟服务器组](cn.zh-CN/用户指南/后端服务器/创建虚拟服务器组.md#)。|
|**主备服务器组**|一个主备服务器组由两台后端服务器组成，即一台主服务器，一台备服务器。当您有传统的主备需求时，可以使用主备服务器组。当主机工作正常时，将流量转发至主服务器；当主机宕机时，会将流量转发至备服务器，避免服务中断。详情参考[创建主备服务器组](cn.zh-CN/用户指南/后端服务器/创建主备服务器组.md#)。|
|**双向认证**|开启该配置后支持在服务端和客户端进行HTTPS双向认证，您需要上传服务器证书和CA证书。不开启，单向认证只需上传服务器证书。

**说明：** 该选项只适用于HTTPS监听。

|
|**服务器证书**|用于用户浏览器检查服务器发送的证书是否是由自己信赖的中心签发的。服务器证书可以到阿里云云盾证书服务购买，也可以到其它服务商购买。服务器证书需要上传到负载均衡的证书管理系统。详情参考[上传证书](cn.zh-CN/用户指南/证书管理/上传证书.md#)。

**说明：** 该选项只适用于HTTPS监听。

|
|**CA证书**|服务器用CA证书验证收到的客户端证书。如果没有通过验证，拒绝连接。开启双向认证功能后，CA证书和服务器证书都需要上传到负载均衡的证书管理系统。详情参考[生成证书](cn.zh-CN/用户指南/证书管理/生成证书.md#)。**说明：** 该选项只适用于HTTPS监听。

|
|**创建完毕自动启动监听**|是否在监听配置完成后启动负载均衡监听，默认开启。|
|高级配置|
|**获取真实IP**|针对七层服务，负载均衡通过HTTP Header: X-Forwarded-For获取来访者真实IP。|
|**会话保持**|开启会话保持功能后，负载均衡会把来自同一客户端的访问请求分发到同一台后端服务器上进行处理。针对七层（HTTP协议和HTTPS协议）监听，负载均衡使用Cookie进行会话保持。负载均衡提供了两种Cookie处理方式：

-   **植入Cookie**：您只需要指定Cookie的过期时间。

客户端第一次访问时，负载均衡会在返回请求中植入Cookie（即在HTTP/HTTPS响应报文中插入SERVERID），下次客户端携带此Cookie访问，负载均衡服务会将请求定向转发给之前记录到的后端服务器上。

-   **重写Cookie**：可以根据需要指定HTTPS/HTTP响应中插入的Cookie。您需要在后端服务器上维护该Cookie的过期时间和生存时间。

负载均衡服务发现用户自定义了Cookie，将会对原来的Cookie进行重写，下次客户端携带新的Cookie访问，负载均衡服务会将请求定向转发给之前记录到的后端服务器。详情参考[会话保持规则配置](../../../../cn.zh-CN/最佳实践/配置服务器Cookie.md#)。


查看[会话保持常见问题](../../../../cn.zh-CN/常见问题/会话保持常见问题.md#)了解更多信息。

|
|**连接空闲超时时间**|指定连接空闲超时时间，取值范围为1-60秒。在超时时间内一直没有访问请求，负载均衡会暂时中断当前连接，直到一下次请求来临时重新建立新的连接。

该功能已经在全部地域开放。

|
|**请求超时时间**|指定请求超时时间，取值范围为1-180秒。在超时时间内后端服务器一直没有响应，负载均衡将放弃等待，给客户端返回HTTP 504错误码。

该功能已经在全部地域开放。

|
|**Gzip数据压缩**|开启该配置对特定文件类型进行压缩。目前Gzip支持压缩的类型包括：text/xml、text/plain、text/css、application/javascript、application/x-javascript application/rss+xml、application/atom+xml、application/xml。

|
|**附加HTTP头字段**|选择您要添加的自定义HTTP header字段：-   **客户端真实IP**: 添加`X-Forwarded-For`字段获取客户端的IP地址。
-   **SLB监听协议**: 添加`X-Forwarded-Proto`字段获取客户端与监听连接时所用的协议 \(HTTP或HTTPS\)。
-   **SLB实例入口IP**: 添加`SLB-IP`字段获取负载均衡实例的公网IP。
-   **SLB实例ID**: 添加`SLB-ID`字段获取负载均衡实例的ID。

|
|**启用访问控制**|选择是否启用访问控制。|
|**访问控制方式**|开启访问控制后，选择一种访问控制方式：-   白名单：仅转发来自所选访问控制策略组中设置的IP地址或地址段的请求，白名单适用于应用只允许特定IP访问的场景。

设置白名单存在一定业务风险。一旦设置白名单，就只有白名单中的IP可以访问负载均衡监听。如果开启了白名单访问，但访问策略组中没有添加任何IP，则负载均衡监听会转发全部请求。

-   黑名单：来自所选访问控制策略组中设置的IP地址或地址段的所有请求都不会转发，黑名单适用于应用只限制某些特定IP访问的场景。

如果开启了黑名单访问，但访问策略组中没有添加任何IP，则负载均衡监听会转发全部请求。


|
|**访问控制策略组**|选择访问控制策略组，作为该监听的白名单或黑名单。详情参见[访问控制策略组](cn.zh-CN/用户指南/访问控制/配置访问控制策略组.md#)。|

