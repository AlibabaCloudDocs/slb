# 配置负载均衡实例

创建负载均衡实例后，您需要对负载均衡实例进行配置才能进行流量转发，您需要添加至少一个监听和一组后端服务器。本指南指引您配置一个TCP监听并添加部署了静态网页的两个ECS实例（ECS01和ECS02）作为后端服务器。

1.  登录[负载均衡管理控制台](https://slb.console.aliyun.com/slb)。

2.  在实例管理页面，单击要配置监听的实例操作列的**监听配置向导**。

    ![实例管理](../images/p167119.png "实例管理")

3.  在协议&监听页签下，根据如下信息，配置监听规则，其它配置保持默认选项。

    ![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2724068951/p7515.png)

    -   **选择负载均衡协议**：本教程选择**TCP**协议。
    -   **监听端口**：用来接收请求并向后端服务器进行请求转发的负载均衡系统的前端协议和端口。

        本教程端口设置为**80**。

    -   **监听名称**：监听对外显示的名称。如不填写，系统默认为协议\_端口。
4.  单击高级配置右边的**修改**，进行其他参数设置。

    ![监听高级配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3351564161/p244142.png)

    -   **调度算法**：负载均衡支持如下三种调度算法，本教程选择**轮询**。
        -   加权轮询模式：将访问请求依序分发后端服务器，后端服务器的权重越高，被分发的几率也越大。
        -   加权最小连接数模式：除了根据每台后端服务器设定的权重值来进行轮询，同时还考虑后端服务器的实例连接数。当权重值相同时，当前连接数越小的后端服务器被轮询到的次数也越高。
        -   轮询模式：按照访问顺序将访问请求分发给后端服务器。
    -   **开启会话保持**：开启后，将同一IP地址的请求转发至同一台后端服务器进行处理。
    -   **启用访问控制**：启用后，可通过配置白名单或黑名单，允许或禁止某些特定的IP地址访问负载均衡。
    -   **开启监听带宽限速**：设定不同的带宽峰值来限定后端ECS实例的不同应用所能对外提供的服务能力。

        本教程创建的公网负载均衡实例是按流量计费的，不受带宽峰值限制，所以不进行配置。

    -   **连接超时时间**：连接空闲时间超过该设定时长后，负载均衡会自动断开连接。取值范围为10~900秒。
    -   **获取客户端真实IP**：默认开启。
5.  单击**下一步**，在后端服务器页签下，选择**默认服务器组**，单击**继续添加**，添加后端服务器。

    1.  在我的服务器面板，勾选之前创建的ECS01和ECS02实例，单击**下一步**。

    2.  配置权重，权重越大转发的请求越多，默认为100，保持默认值即可。

    3.  单击**添加**。

    4.  在**默认服务器**页签下，配置后端协议端口，ECS实例上开放的用来接收请求的后端端口，在同一个负载均衡实例内可重复。本教程端口设置为80。

    ![](../images/p7516.png "默认服务器")

6.  单击**下一步**，配置健康检查，本教程使用默认值。

    开启健康检查功能后，当后端某个ECS健康检查出现问题时，负载均衡服务会将请求转发到其它健康检查正常的ECS上，而当该ECS恢复正常运行时，负载均衡会自动恢复它的请求转发。

7.  单击**下一步**，进入配置审核页签，单击**提交**。

    ![](../images/p7517.png "配置审核")

8.  单击**知道了**，返回实例管理页面，单击![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2724068951/p7518.png)。

    当后端ECS的健康检查状态为**正常**时，表示后端ECS可以正常处理负载均衡转发的请求了。

    ![](../images/p7519.png "实例管理-2")

9.  在浏览器中多次输入负载均衡实例的服务地址，测试负载均衡服务。

    ![ECS01](../images/p242548.png "ECS01")

    ![ECS02](../images/p242550.png "ECS02")


