# 性能保障型实例FAQ

负载均衡性能保障型实例提供了可保障的性能指标，阿里云负载均衡计划将于2018年04月01日开始针对性能保障型实例收取规格费。

本文包含以下常见问题：

-   [1什么是负载均衡性能保障型实例？](#section_lht_gym_vdb)
-   [2. 性能保障型实例如何收费？](#section_eth_yzm_vdb)
-   [3. 性能保障型实例规格费的定价](#section_n5z_s1n_vdb)
-   [4. 如何选择性能保障型实例？](#section_ifx_kcn_vdb)
-   [5. 是否可以调整性能保障型实例的规格？](#p7)
-   [6. 性能保障型实例何时收费？](#section_gvt_kfn_vdb)
-   [7. 收取规格费以后，性能共享型实例会额外收取费用吗？](#section_hxl_pfn_vdb)
-   [8. 为何有时性能保障型实例看起来达不到规格中的性能指标上限？](#section_ehc_vfn_vdb)
-   [9. 还可以购买性能共享型实例吗？](#section_flq_wfn_vdb)
-   [10. 私网负载均衡实例也会收取规格费吗？](#section_nfy_xfn_vdb)
-   [11.性能保障型实例不够用了怎么办？](#section_wvo_8kk_3m9)

## 1什么是负载均衡性能保障型实例？

负载均衡性能保障型实例提供了可保障的性能指标。与之相对的是负载均衡性能共享型实例，资源是所有实例共享的，所以不保障实例的性能指标。

在推出负载均衡性能保障型实例之前，您所有购买的实例均为性能共享型实例。在控制台上，您可以查看已购实例的类型。

性能共享型实例与性能保障型实例区别如下：

|特性|性能共享型实例|性能保障型实例|
|--|-------|-------|
|资源分配|资源共享|资源独享|
|可用性SLA|不提供|99.95%|
|IPv6|×|√|
|支持SNI多证书|×|√|
|支持黑白名单|×|√|
|支持挂ENI|×|√|
|添加ECS弹性网卡辅助IP|×|√|
|HTTP重定向HTTPS|×|√|
|一致性HASH|×|√|
|TLS安全策略|×|√|
|HTTP2|×|√|
|Websocket\(S\)|×|√|

把鼠标移至性能保障型实例的问号图标，可查看具体的性能指标，如下图所示。

![性能保障型实例性能指标](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7167559951/p7175.png)

性能保障型实例的三个关键指标如下：

-   最大连接数-Max Connection

    最大连接数定义了一个负载均衡实例能够承载的最大连接数量。当实例上的连接超过规格定义的最大连接数时，新建连接请求将被丢弃。

-   每秒新建连接数-Connection Per Second（CPS）

    每秒新建连接数定义了新建连接的速率。当新建连接的速率超过规格定义的每秒新建连接数时，新建连接请求将被丢弃。

-   每秒查询数-Query Per Second（QPS）

    每秒请求数是七层监听特有的概念，指的是每秒可以完成的HTTP/HTTPS的查询（请求）的数量。当请求速率超过规格所定义的每秒查询数时，新建连接请求将被丢弃。


阿里云负载均衡性能保障型实例开放了如下六种实例规格（各地域因资源情况不同，开放的规格可能略有差异，请以控制台购买页为准）。

|规格|规格|最大连接数|每秒新建连接数（CPS）|每秒查询数（QPS）|购买方式|
|:-|:-|:----|:-----------|:---------|----|
|规格1|简约型I（slb.s1.small）|5,000|3,000|1,000|官网售卖|
|规格2|标准型I（slb.s2.small）|50,000|5,000|5,000|官网售卖|
|规格3|标准型II（slb.s2.medium）|100,000|10,000|10,000|官网售卖|
|规格4|高阶型I（slb.s3.small）|200,000|20,000|20,000|官网售卖|
|规格5|高阶型II（slb.s3.medium）|500,000|50,000|30,000|官网售卖|
|规格6|超强型I（slb.s3.large）|1,000,000|100,000|50,000|官网售卖|
|规格7|超强型II（slb.s3.xlarge）|2,000,000|200,000|100,000|请联系您的客户经理申请|
|规格8|超强型III（slb.s3.xxlarge）|5,000,000|500,000|100,000|请联系您的客户经理申请|

## 2. 性能保障型实例如何收费？

负载均衡性能保障型实例需要收取规格费用，收费模型如下：

性能保障型费用=实例费+流量/带宽费+规格费

**说明：** 负载均衡私网实例也可以选择性能共享型实例或性能保障型实例，性能保障型私网实例，也需要收取规格费用，收费方式与公网性能保障型实例一致，但不收取流量费/带宽费和实例费。

负载均衡分为两种计费模式，包年包月和按量计费。在不同的计费模式下，性能保障型实例的规格费收取规则不同：

-   包年包月模式

    性能保障型实例规格费按照包年包月模式收取，即在实例的付费周期内，实例规格费按照固定的价格收取。假设您选择的是高阶型I （slb.s3.small）规格，并且选择购买时长为3个月，则规格费用=slb.s3.small规格费月价\*3月。

-   按量付费模式

    性能保障型实例规格费按使用量收取，即不论您选择的何种规格，实例规格费均会按照您实际使用的规格收取。

    例如，您选择了超强型I（slb.s3.large）规格（最大连接数1,000,000；CPS 100,000；QPS 50,000）。您的实例在某个小时内各项指标产生的实际峰值如下：

    |最大连接数|每秒新建连接数（CPS）|每秒查询数（QPS）|
    |:----|:-----------|:---------|
    |90000|4000|11000|

    -   从最大连接数维度看，90,000超过slb.s2.small规格中最大连接数50,000的上限，但未达到slb.s2.medium规格中最大连接数的100,000上限，因此从最大连接数维度计算，该小时规格为slb.s2.medium。
    -   从每秒新建连接数（CPS）维度看，4,000超过slb.s1.small规格中CPS 3,000的上限，但未到达slb.s2.small规格中CPS 5,000的上限，因此从CPS维度计算，该小时规格为slb.s2.small。
    -   从每秒查询数（QPS）维度看，11,000超过slb.s2.medium规格中QPS 10,000的上限，但未达到slb.s3.small中QPS 20,000的上限，因此从QPS维度计算，该小时规格为slb.s3.small。

        综合以上三个维度，QPS指标的规格（slb.s3.small）最大，因此将QPS维度的规格作为该小时实例的综合规格，该小时内该实例将按照slb.s3.small规格进行计费。

    以后每小时规格费均按照上述方式计算，如下图所示：

    ![每小时规格费计算结果](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7167559951/p2301.png)

    因此，按量付费的性能保障型实例具有自动弹性伸缩（或计费）的能力。您在购买时所选的规格，是性能的上限，例如您选择高阶型II（slb.s3.medium），那么意味着，您的实例最大可以达到的规格上限就是高阶型II（slb.s3.medium）。


## 3. 性能保障型实例规格费的定价

下表中所列的只是规格费用。除规格费以外，负载均衡实例的实例费和流量/带宽费正常收取。详细信息，请参见[计费说明](/cn.zh-CN/产品定价/按量计费.md)。

|地域|规格|规格|最大连接数|每秒新建连接数 （CPS）|每秒查询数（QPS）|包年包月（元/月）|按量付费（元/时）|带宽|
|:-|:-|:-|:----|:------------|:---------|:--------|:--------|--|
|中国内地|规格1|简约型I（slb.s1.small）|5,000|3,000|1,000|限时免费，详情请参见[SLB性能保障型实例最小规格计费调整说明](/cn.zh-CN/动态与公告/产品公告/SLB性能保障型实例最小规格计费调整说明.md)|限时免费，详情请参见[SLB性能保障型实例最小规格计费调整说明](/cn.zh-CN/动态与公告/产品公告/SLB性能保障型实例最小规格计费调整说明.md)|带宽与规格无关：-   按流量计费实例：实例带宽参见[带宽峰值限制](/cn.zh-CN/用户指南/产品限制/带宽峰值限制.md)
-   按带宽计费实例：购买时选择的带宽 |
|规格2|标准型I（slb.s2.small）|50,000|5,000|5,000|190.00|0.32|
|规格3|标准型II（slb.s2.medium）|100,000|10,000|10,000|380.00|0.63|
|规格4|高阶型I（slb.s3.small）|200,000|20,000|20,000|760.00|1.27|
|规格5|高阶型II（slb.s3.medium）|500,000|50,000|30,000|1,143.00|1.91|
|规格6|超强型I（slb.s3.large）|1,000,000|100,000|50,000|1,908.00|3.18|
|海外和中国香港|规格1|简约型I（slb.s1.small）|5,000|3,000|1,000|限时免费，详情请参见[SLB性能保障型实例最小规格计费调整说明](/cn.zh-CN/动态与公告/产品公告/SLB性能保障型实例最小规格计费调整说明.md)|限时免费，详情请参见[SLB性能保障型实例最小规格计费调整说明](/cn.zh-CN/动态与公告/产品公告/SLB性能保障型实例最小规格计费调整说明.md)|带宽与规格无关：-   按流量计费实例：实例带宽参见[带宽峰值限制](/cn.zh-CN/用户指南/产品限制/带宽峰值限制.md)
-   按带宽计费实例：购买时选择的带宽 |
|规格2|标准型（slb.s2.small）|50,000|5,000|5,000|228.00|0.38|
|规格3|标准型II（slb.s2.medium）|100,000|10,000|10,000|456.00|0.76|
|规格4|高阶型I（slb.s3.small）|200,000|20,000|20,000|912.00|1.52|
|规格5|高阶型II（slb.s3.medium）|500,000|50,000|30,000|1,372.00|2.29|
|规格6|超强型I（slb.s3.large）|1,000,000|100,000|50,000|2,290.00|3.82|

## 4. 如何选择性能保障型实例？

-   如果您购买的是按量付费实例，如上文所描述，规格费是按量（弹性）计费的，因此建议您直接选择您可以买到的最大规格，对于大多数用户而言，即高阶型I（slb.s3.small），这样可以保证较好的业务灵活性（弹性），且不会让您额外多付出成本。但如果您认为您的业务量不太可能到达超强型I（slb.s3.large），也可以设置一个合理的弹性上限，例如高阶型II（slb.s3.medium）。
-   如果您购买的是包年包月实例，情况会略微复杂一点。因为规格费按照固定费率恒定收取，而您不希望购买一个超出您实际业务量很多的规格，并因此付出不必要的成本，因此您需要评估您的实际业务量，并合理的考虑一些冗余，然后选择一个较合适的规格，对于业务量评估来说，主要参考下面几个原则：
    -   如果是四层监听，关注的重点是长连接的并发连接数，那么最大（并发）连接数应当作为一个关键指标来参考。根据不同的业务场景，您需要预估一个负载均衡实例需要承载的最大并发连接数，并选择相应的规格。
    -   如果是七层监听，关注的重点是QPS的性能，QPS决定了一个七层应用系统的吞吐量。同样，您也需要根据经验对QPS进行预估。在初步选定一个规格后，在业务压测和实测过程中对规格进行微调。
    -   结合与性能保障型实例一起推出的其它关键监控指标，查看实际业务流量的走势、峰值情况，对性能规格进行更加精确的选取。详细信息，请参见[通过控制台查看监控](/cn.zh-CN/用户指南/监控/监控/通过控制台查看监控.md)。

        并发连接数监控示例如下：

        ![并发连接数](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8167559951/p89278.png)

        新建连接数监控示例如下：

        ![新建连接数](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8167559951/p89280.png)

        QPS监控示例如下：

        ![QPS协议](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8167559951/p89281.png)


## 5. 是否可以调整性能保障型实例的规格？

您可在控制台对性能保障型实例进行变配。详细信息，请参见[包年包月实例变配](/cn.zh-CN/用户指南/实例/实例变配/包年包月实例变配.md)。

按量付费的性能保障型实例的规格可以升配也可以降配，包年包月的性能保障型实例需要开通白名单才可以降配。详细信息，请参见[包年包月实例变配](/cn.zh-CN/用户指南/实例/实例变配/包年包月实例变配.md)。

因此，建议您先使用按量付费的实例进行业务测试，确认好规格后再购买所需规格的包年包月实例。

**说明：**

-   将性能共享型实例变更为性能保障型实例后，无法再将其变更回性能共享型。
-   变更性能保障型实例规格时，如果同时变更计费方式（按流量计费或按带宽计费），则规格变更需要到次日零点才能生效。如果仅仅是对实例规格进行变更，变更立即生效。建议您在变更规格时，尽量不要变更计费方式。
-   由于历史存量原因，部分实例可能存在于较老的集群。此部分实例在变配到性能保障型实例时，因为需要将实例迁移，因此可能出现10~30秒的业务中断，其他变配操作均不会影响业务。因此建议在业务低谷期进行此类变配。
-   所有的变配操作都不影响负载均衡实例的IP地址。

![警告信息](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8167559951/p7345.png)

## 6. 性能保障型实例何时收费？

阿里云负载均衡于2018年04月01日开始针对性能保障型实例收取规格费，同时继续保留性能共享型实例的售卖。

性能保障型实例的规格费收取将按地域分批次生效：

-   第一批：

    生效时间：04月01日至04月10日陆续生效

    生效地域：新加坡、马来西亚（吉隆坡）、印度尼西亚（雅加达）、印度（孟买）、美国（硅谷）和美国（弗吉尼亚）

-   第二批：

    生效时间：04月11日至04月20日陆续生效

    生效地域：华东1（杭州）、华北3（张家口）、华北5（呼和浩特）和中国香港

-   第三批：

    生效时间：04月21日至04月30日陆续生效

    生效地域：华北1（青岛）、华北2（北京）、华东2（上海）和华南1（深圳）


## 7. 收取规格费以后，性能共享型实例会额外收取费用吗？

不会。

原有的性能共享型实例（如果您不将其变配性能保障型）将继续保持为性能共享型实例，不收取规格费。您也可以通过变配，将性能共享型实例升级成性能保障型实例。变更成性能保障型后，当性能保障型实例开始正式收费时，该实例将收取规格费。

## 8. 为何有时性能保障型实例看起来达不到规格中的性能指标上限？

短木板原理。

性能保障型实例并不保障三个指标（包含带宽指标）同时达到指定规格的指标上限。即规格中哪个指标先达到峰值，就以哪个指标开始限速。

同样，如果购买了按带宽付费的实例，当实例带宽达到峰值上限时，也可能会出现因为带宽限速而导致某些指标达不到规格上限的情况。

例如某用户选择高阶型I（slb.s3.small）实例，当实例的QPS已经达到20000，但并发连接数确远未达到20万，那么该实例最大连接数可能永远都不会达到规格上限，因为新建的连接请求会因为QPS达到上限而被丢弃。

## 9. 还可以购买性能共享型实例吗？

不可以。

## 10. 私网负载均衡实例也会收取规格费吗？

如果您选择的是性能共享型私网实例，则不会收取规格费。如果您选择的是性能保障型私网实例，则需要收取规格费。

规格费收取方式与公网实例规格费计费规则一致。私网实例免收实例费和流量费。

## 11.性能保障型实例不够用了怎么办？

当您需要更多实例配额，且配额管理中已不能申请更高时，可以考虑申请拥有更多保障型规格实例Quota的特权，配额编码slb\_privilege\_allow\_more\_guaranteed\_performance\_instances，申请此特权后，即可保有更多保障型实例配额，但无法保有更多共享型实例，具体操作，请参见[配额管理](/cn.zh-CN/用户指南/产品限制/配额管理.md)。

