# 添加域名或URL转发规则 {#concept_sh5_nj5_vdb .concept}

## 域名或URL转发规则 {#section_hll_n31_wdb .section}

七层负载均衡服务支持配置域名或者URL转发策略，将来自不同域名或者URL的请求转发给不同的ECS处理。您可以在一个监听下添加多条转发策略，每条转发策略关联不同的虚拟服务器组（一个虚拟服务器组由一组ECS实例组成）。比如您可以将所有读请求转发到一组后端服务器上而将写请求转发到另一组后端服务器上，这样可以更灵活地适配业务需求，合理分配资源。

如下图所示，在配置了转发策略后，负载均衡系统将按照以下规则转发前端请求：

-   如果能匹配到相应监听关联的转发策略，则按转发策略，将请求转发到对应的虚拟服务器组。
-   如果未匹配，而对应监听启用并配置了虚拟服务器组，则将请求转发到对应的虚拟服务器组。
-   如果均未匹配，则转发到负载均衡实例后端服务器池中的ECS。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/4135/2798_zh-CN.png)

您不需要在转发规则上单独配置健康检查，下表对比描述了三个维度的健康检查机制。

|维度|健康检查配置|健康检查目标服务器|
|:-|:-----|:--------|
|后端服务器|使用配置监听时的健康检查配置|所有后端ECS|
|虚拟服务器组|使用配置监听时的健康检查配置|相应虚拟服务器组包含的服务器|
|转发策略|使用配置监听时的健康检查配置|相应虚拟服务器组包含的服务器|

**说明：** 由于虚拟服务器组中可以对ECS配置不同的端口，因此在配置健康检查时不要设置检查端口，否则会导致采用了不一致端口承载服务的服务器健康检查失败。

## 域名或URL转发规则说明 {#section_b4s_bj1_wdb .section}

负载均衡支持分别添加域名或URL转发规则，也支持添加域名+URL组合的转发规则。

-   域名转发规则配置

    单独配置域名转发规则时，URL配置项留空（不用输入/）。域名只能使用字母、数字、连字符（-）、点（.）。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/4135/2801_zh-CN.png)

    支持精确匹配和通配符匹配两种模式：

    -   精确域名：www.aliyun.com
    -   通配符域名（泛域名）: \*.aliyun.com, \*.market.aliyun.com

        当前端请求同时匹配多条域名规则时，规则的匹配优先级为：精确匹配 \> 小范围通配符匹配 \> 大范围通配符匹配，如下表所示。

        |模式|请求测试URL|域名规则与匹配情况|
        |:-|:------|:--------|
        | | |www.aliyun.com|\*.aliyun.com|\*.market.aliyun.com|
        |精确匹配|www.aliyun.com|√| | |
        |泛域名匹配|market.aliyun.com| |√| |
        |泛域名匹配|info.market.aliyun.com| | |√|

-   URL转发规则配置

    单独配置URL转发规则时，域名配置项留空。参考以下原则添加URL：

    -   URL只能包含字母、数字和以下特殊字符：

        -./%?\#&。

    -   URL必须以斜杆（/）开头。

        **说明：** 如果您在URL中只输入了一个斜杆（/），则URL转发规则失效。

    -   URL转发支持字符串匹配，按照顺序匹配原则。比如 /admin、/bbs、/test。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/4135/2804_zh-CN.png)

-   域名+URL转发规则配置

    当需要根据相同域名下不同的URL路径进行流量转发时，建议您配置一个默认转发策略（URL留空），以免未匹配到的其它URL访问出错。参见[如何实现相同域名不同路径的流量转发](../cn.zh-CN/最佳实践/如何实现相同域名不同路径的流量转发.md#)。

    比如有两个域名分别是www.aaa.com和www.bbb.com，要求访问www.aaa.com/index.html时，将请求转发给ServerGroup1处理，其它来自xxx.html的请求转发给ServerGroup2处理。您需要配置如下转发策略，否则匹配到www.aaa.com的域名但没有相关策略匹配会返回404的响应码。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/4135/2807_zh-CN.png)


## 配置域名URL转发策略 {#section_z1n_t1b_wdb .section}

前提条件

-   您已经创建了七层（HTTP/HTTPS）监听，详情参考[配置监听](cn.zh-CN/用户指南/监听/监听介绍.md#)。
-   您已经创建了接收请求的虚拟服务器组。详情参考[创建虚拟服务器组](cn.zh-CN/用户指南/后端服务器/创建虚拟服务器组.md#)。

操作步骤

1.  登录[负载均衡管理控制台](http://slbnew.console.aliyun.com/#/list/cn-hangzhou)。
2.  在实例管理页面，选择地域，查看该地域的所有负载均衡实例。
3.  单击负载均衡实例的ID链接。
4.  在详情页面的左侧导航栏，单击**监听**。
5.  单击目标七层监听的**操作**列内的**更多** \> **添加转发策略**。
6.  在转发策略页面，单击**添加转发策略**。
7.  在添加转发策略对话框，配置转发规则，然后单击**确认**。
8.  单击**添加转发策略 +**添加另一条转发策略，单击**确认**完成配置。

