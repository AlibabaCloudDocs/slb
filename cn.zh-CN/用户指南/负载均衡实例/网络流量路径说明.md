# 网络流量路径说明 {#concept_ev3_wsm_vdb .concept}

## 入网流量路径 {#section_fxh_xgn_vdb .section}

对于入网流量，负载均衡会根据用户在控制台或API上配置的转发策略，对来自前端的访问请求进行转发和处理。数据流转如下图所示。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/4114/2333_zh-CN.png)

1.  不论是TCP/UDP协议还是HTTP/HTTPS协议，流量都要首先经过LVS集群进行转发。
2.  LVS集群内的每一台节点服务器均匀地分配海量访问请求，并且每一台节点服务器之间都有会话同步策略，以保证高可用。
3.  如果相应的负载均衡实例服务端口使用的是四层协议（TCP或UDP），那么LVS集群内每个节点都会根据负载均衡实例负载均衡策略，将其承载的服务请求按策略直接分发到后端ECS服务器。
4.  如果相应的负载均衡实例服务端口使用的是七层HTTP协议，那么LVS集群内每个节点会先将其承载的服务请求均分到Tengine集群；而后，Tengine集群内的每个节点再根据负载均衡策略，将服务请求按策略最终分发到后端ECS服务器。
5.  如果相应的负载均衡实例服务端口使用的是七层HTTPS协议，与上述HTTP处理过程类似，差别是在按策略将服务请求最终分发到后端ECS服务器前，会先调用Key Server进行证书验证及数据包加解密等前置操作。

## 出网流量路径 {#section_jcv_ghn_vdb .section}

负载均衡SLB和后端ECS之间是通过内网进行通信的，所以如果ECS仅仅处理来自负载均衡的请求，那么可以不需要购买公网带宽（ECS公网IP/弹性公网IP/NAT网关等）。如果还需要直接通过后端ECS对外提供服务，或后端ECS有访问外网的需求， 那么需要相应的配置或购买ECS公网IP/弹性公网IP/NAT网关等服务，ECS的公网流量访问路径如下图所示。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/4114/2335_zh-CN.png)

总体原则：流量从哪里进来，就从哪里出去：

1.  通过负载均衡进入的流量在负载均衡SLB上限速/计费，仅收取出方向流量费用，入方向流量不收取（在未来可能会改变），SLB到ECS之间是阿里云内网通信，不收取流量费用。
2.  来自弹性公网IP/NAT网关的流量，分别在弹性公网IP/NAT网关上进行限速/计费；如果在购买ECS时选择了公网带宽，限速/计费点在ECS上。
3.  负载均衡SLB仅提供被动访问公网的能力，即后端ECS只能在收到通过负载均衡SLB转发来的公网的请求时，才能访问公网回应该请求，如后端ECS希望主动发起公网访问，则需要配置/购买ECS公网带宽、弹性公网IP或NAT网关来实现。
4.  ECS公网带宽（购买ECS时配置）、弹性公网IP、NAT网关均可以实现ECS的双向公网访问（访问或被访问），但没有流量分发和负载均衡的能力。

