# 规划和准备 {#concept_ug3_rfl_vdb .concept}

在使用负载均衡前，您需要根据您的业务确定负载均衡的监听类型、网络类型等。

## 规划负载均衡实例的地域 {#section_nby_m4l_vdb .section}

阿里云提供包括华北、华东、华南、亚太东南、亚太东北、欧洲中部、美国东部、美国西部、香港、中东东部在内的不同地域的负载均衡服务。

为了提供更加稳定可靠的负载均衡服务，阿里云负载均衡已在各地域部署了多可用区以实现同地域下的跨机房容灾。此外，您也可以在不同地域创建多个负载均衡实例，通过DNS轮询的方式对外提供服务，从而提高跨地域的可用性。

在选择地域时，请注意：

-   为了减少延迟并提高下载速度，建议选择离您客户最近的地域。
-   由于负载均衡不支持跨地域部署，因此应选择与后端ECS实例相同的地域。

## 选择负载均衡实例的类型（公网或私网） {#section_o3k_44l_vdb .section}

根据您的业务类型，确定负载均衡的实例类型。负载均衡实例创建后，系统会根据实例类型分配一个公网服务地址或私网服务地址。

-   公网负载均衡实例仅提供公网IP，可以通过Internet访问负载均衡服务。

    如果您要创建公网类型的负载均衡实例，还需根据具体业务特点确定计费方式：

    -   按流量计费：适用于波峰波谷效应明显的业务。
    -   按带宽计费：适用于带宽较为平稳的业务。
-   私网负载均衡实例仅提供阿里云私网IP，只能通过阿里云内部网络访问该负载均衡服务，无法从Internet访问。私网类型的负载均衡实例不收取费用。

## 选择监听协议 {#section_bhq_r4l_vdb .section}

负载均衡提供四层（TCP协议和UDP协议）和七层（HTTP协议和HTTPS协议）监听。

-   四层监听将请求直接转发给后端服务器，不会修改标头。客户端请求到达负载均衡监听后，负载均衡服务器会使用监听中配置的后端端口与后端ECS建立TCP连接。
-   七层监听原理上是反向代理的一种实现。客户端请求到达负载均衡监听后，负载均衡服务器会通过与后端ECS建立TCP连接，即再次通过新TCP连接HTTP协议访问后端，而不是直接转发报文到后端ECS。

    由于七层监听比四层监听在底层实现上多了一个Tengine处理环节，因此，七层监听性能没有四层好。此外，客户端端口不足、后端服务器连接过多等场景也可能导致七层服务性能不高，如果您对性能有很高的要求，建议您使用四层监听。


## 准备后端服务器 {#section_f5v_54l_vdb .section}

您需要在负载均衡实例中添加ECS来处理前端监听转发的请求。在创建负载均衡前，需要创建好ECS实例并部署相关应用。创建ECS时，请注意：

-   ECS实例的地域和可用区

    确保ECS实例的地域和负载均衡实例的地域相同。此外，建议您将ECS部署在不同的可用区内，提高本地可用性。

-   ECS配置

    在ECS上部署好应用后，不需要再进行特别的配置。但如果您要配置一个四层监听（TCP协议或UDP协议），并且ECS使用的是Linux系统，确保net.ipv4.conf文件中的以下三个参数的值为0：

    ```
    
    net.ipv4.conf.default.rp_filter = 0
    net.ipv4.conf.all.rp_filter = 0
    net.ipv4.conf.eth0.rp_filter = 0
    ```

-   ECS部署

    目前负载均衡实例后端可配置的ECS数量没有限制。但是，为了保证对外服务的稳定与高效，建议您根据业务分类或应用服务的模块划分，将提供不同服务或执行不同任务的应用服务器ECS添加到不同的负载均衡实例中。


