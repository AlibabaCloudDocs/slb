# 结合云解析实现跨地域负载均衡 {#concept_hqf_4k5_vdb .concept}

## 全球负载均衡 {#section_nyz_jlc_wdb .section}

负载均衡从其应用的地理结构上分为本地负载均衡和全局负载均衡。本地负载均衡是指对同地域的服务器群做负载均衡，全局负载均衡是指对分别部署在不同地域有不同网络结构的服务器群做负载均衡。

结合云解析（全球负载均衡版），您可在本地负载均衡上层部署云解析（全球负载均衡版），实现跨地域容灾和智能解析。

-   多线路智能化解析服务

    云解析（全球负载均衡版）支持多线智能解析，即根据网站访问者所在的网络类型，智能判断提供最佳的访问解析地址，使访问用户获得最快捷、最流畅的体验。

    如下图所示，当判断访问者来源为海外用户，则将域名解析到位于美国的负载均衡实例上；当判断访问者来源为国内用户，则将域名解析到到国内的负载均衡实例上。

-   跨地域容灾

    云解析提供监控服务，监控主机记录下的IP地址。根据网站监控探测结果，实时隔离故障集群，流量动态切换，实现跨地域容灾。


## 部署全球负载均衡 {#section_zkj_hmc_wdb .section}

本操作以一个域名为aliyuntest.club的网站为例（该网站的大多数用户分布在新加坡和国内），指导您如何通过云解析和负载均衡实现全局负载均衡均衡。

步骤一 购买与配置云服务器

根据您的应用服务的用户的地域分布，在相应地域下购买并配置至少两台ECS。

本操作中，在北京、深圳、新加坡这三个地域分别购买了两台ECS，并在ECS上搭建了一个简单的静态网页。

-   北京地域ECS示例
-   深圳地域ECS示例
-   新加坡地域ECS示例

## 步骤二 购买与配置负载均衡实例 {#section_u35_ypc_wdb .section}

1.  参考[创建负载均衡实例](../../../../intl.zh-CN/用户指南/负载均衡实例/创建负载均衡实例.md#)分别在北京、深圳、新加坡创建三个公网负载均衡实例。
2.  参考[配置负载均衡实例](../../../../intl.zh-CN/用户指南/负载均衡实例/管理负载均衡实例.md#)添加监听并将各个地域下配置好的ECS添加到后端服务器池。

-   北京地域负载均衡实例示例
-   深圳地域负载均衡实例示例
-   新加坡地域负载均衡实例示例

## 步骤三 配置全球负载均衡 {#section_fkw_drc_wdb .section}

1.  购买云解析全球负载均衡版。
    1.  在全球负载均衡页面，单击**立即购买**。
    2.  配置云解析全球负载均衡。

        本操作中，除以下配置外，其它配置使用默认选项：

        -   配置类型，选择**全球负载均衡版**。
        -   全球负载均衡类型，选择**线路间负载均衡**。
        -   绑定您的网站域名。您也可以在创建后绑定域名。
    3.  单击**立即购买**。
    4.  在云解析DNS管理控制台的VIP产品页面，查看创建的全球负载均衡版云解析实例。
2.  设置智能解析。
    1.  登录域名服务管理控制台。
    2.  找到云解析实例绑定的域名，然后单击其**操作**列下的**解析设置**。
    3.  设置域名解析。添加三条A记录分别指向创建的负载均衡实例的公网IP，并将新加坡地域的A记录解析线路设置为**海外**。
3.  添加网站监控。
    1.  在解析设置页面，单击**网站监控**。
    2.  单击**添加监控**，将三条A记录的IP地址添加到监控列表中。
    3.  单击每条监控记录对应的**设置**选项，修改监控配置。

        将域名记录无法访问时的切换规则设置为**强制暂停该记录解析**。

4.  开启全球负载均衡。
    1.  在解析设置页面，单击**全球负载均衡**。
    2.  单击**线路间负载均衡**页签，选择目标域名，然后单击**开启**。
    3.  在弹出的对话框中，单击**确定**。

## 步骤四 测试 {#section_sxj_ntc_wdb .section}

移除北京地域负载均衡实例的后端服务器，使该负载均衡实例的服务不可用。

访问该网站，查看访问是否正常。

**说明：** 云解析DNS监控到您的IP宕机后需要1-2分钟聚合判断，假设您的监控频率设置是1分钟，那么线路异常切换生效时间在2-3分钟内；如果您的监控频率设置是10分钟，那么线路异常切换生效时间在12-13分钟内。

