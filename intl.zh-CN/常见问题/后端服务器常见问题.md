# 后端服务器常见问题 {#concept_dt4_dh5_vdb .concept}

## 1. 负载均衡实例最多支持添加多少ECS实例？ {#section_at3_knx_wdb .section}

默认每个SLB实例可以添加200个ECS实例，一个ECS实例可以被50个SLB实例关联。

**说明：** 如果您需要添加更多ECS实例，请提交工单申请。通过审核后，为您提升配额。

为了保证您对外服务的稳定与高效，建议您根据业务分类或应用服务的模块划分将提供不同服务或执行不同任务的应用服务器配置在不同的负载均衡实例上。

## 2. 负载均衡运行中是否可调整ECS数量？ {#section_bt3_knx_wdb .section}

可以。

您可以在任意时刻增加或减少负载均衡的后端ECS实例数量并且支持不同ECS实例之间的切换。但是为了保证您对外服务的稳定，确保在执行上述操作时，开启了负载均衡的健康检查功能并保证负载均衡后端至少有一台正常运行的ECS实例。

## 3. 后端ECS实例的操作系统是否可以不同？ {#section_ct3_knx_wdb .section}

可以。

负载均衡本身不会限制后端ECS实例使用哪种操作系统，只要确保后端ECS实例中的应用服务部署相同且数据一致即可。但建议使用相同的操作系统，以便您日后的管理维护。

## 4. 可以使用不同地域的ECS实例作为后端服务器么？ {#section_dt3_knx_wdb .section}

不可以。

负载均衡不支持跨地域部署。负载均衡实例的地域和后端ECS实例的地域必须相同。

## 5. 后端ECS实例为什么访问不了负载均衡服务？ {#section_et3_knx_wdb .section}

这和负载均衡TCP的实现机制有关。在四层TCP协议服务中，不支持后端ECS实例既作为Real Server又作为客户端向所在的负载均衡实例发送请求。因为返回的数据包只在云服务器内部转发，不经过负载均衡，所以在后端ECS实例上去访问负载均衡的服务地址是不通的。

## 6. ECS实例在接入负载均衡服务前添加了白名单，对负载均衡服务有影响么？ {#section_ft3_knx_wdb .section}

若ECS实例在接入负载均衡前设置了访问白名单，那么接入负载均衡后需要将负载均衡的白名单添加到ECS实例中，否则可能会引起网站403报错。

需要添加的负载均衡地址为100.64.0.0/10（100.64.0.0/10 是阿里云保留地址，其他用户无法分配到该网段内，不会存在安全风险）。

## 7. 为什么有100开头的IP在频繁访问ECS实例？ {#section_gt3_knx_wdb .section}

负载均衡系统除了会通过系统服务器的内网IP将来自外部的访问请求转到后端ECS实例之外，还会对ECS实例进行健康检查和可用性监控，这些访问的来源都是由负载均衡系统发起的。

负载均衡系统的地址段为100.64.0.0/10（100.64.0.0/10 是阿里云保留地址，其他用户无法分配到该网段内，不会存在安全风险），所以会有很多100开头的IP地址访问ECS实例。

为了确保您对外服务的可用性，确保对上述地址的访问配置了放行规则。

## 8. 要使用负载均衡服务，ECS实例是否需要进行特殊配置？ {#section_ht3_knx_wdb .section}

添加到负载均衡实例的后端ECS实例，原则上不需要进行特别的配置。

但是，如果后端ECS实例的操作系统为Linux并且使用了TCP监听，确保系统配置文件/etc/sysctl.conf中以下三个配置的值为零：

```
net.ipv4.conf.default.rp_filter = 0
net.ipv4.conf.all.rp_filter = 0
net.ipv4.conf.eth0.rp_filter = 0
```

如果部署在同一内网网段下的ECS实例之间有通信需求，需要检查如下参数的配置是否正确。更改配置后，执行sysctl -p更新配置。

```
net.ipv4.conf.default.arp_announce =2
net.ipv4.conf.all.arp_announce =2
```

## 9. 部署了多站点的ECS实例可以添加到同一个负载均衡实例中么？ {#section_kt3_knx_wdb .section}

可以，详情参考[负载均衡+ECS多站点部署](../intl.zh-CN/最佳实践/负载均衡+ECS多站点部署.md#)。

一个负载均衡实例最多支持添加50个监听，每个监听配置对应后端ECS实例上的一个应用。您可以通过对后端ECS实例上的多个应用配置不同主机头的方式来满足这一需求。

## 10. ECS实例设置权重的作用是什么？ {#section_lt3_knx_wdb .section}

权重比越高的ECS实例将被分配到更多的访问请求，您可以根据后端ECS实例的对外服务能力和需求来区别设定。

将负载均衡池中的A、B两台ECS实例的权重均配置成100和均配置成50都是一样的，在A、B两台ECS实例健康检查状态均正常的情况下，ECS实例A和B均分前端请求的流量。但是如果A和B的权重分别设置为10和100，在A、B两台ECS实例健康检查状态均正常的情况下，A承担10/\(10+100\)的流量，B承担100/\(10+100\)的流量。

如果您同时开启了会话保持功能，有可能会造成后端ECS实例访问不均衡，建议您暂时关闭会话保持功能再观察一下是否依然存在这种情况。

当负载均衡分发到后端ECS实例的请求不均匀时，参考以下方法检查处理：

1.  统计一个时间段内后端ECS实例的Web服务访问日志的数据量。

    访问日志查看方法：

    -   Nginx和Apache：打开日志目录/access.log。
    -   IIS：打开IIS管理界面，鼠标放在需要设置开启日志的站点上，单击右键，选择**属性**，选择**网站**选项卡，单击**启用日志记录**。
2.  按照负载均衡的配置，对比多个ECS实例日志的数量是否有差距。

    如果设置了会话保持，需要剥离相同IP的访问日志。如果负载均衡配置了权重，要根据权重比例计算日志中访问比例是否正常。


## 11. ECS实例上没有配置压缩，为什么从负载均衡返回的响应却被压缩了? {#section_ot3_knx_wdb .section}

可能是客户端浏览器端支持压缩。您可以在控制台上创建监听时关闭Gzip压缩功能，或改用TCP监听。

## 12. ECS实例使用了HTTP1.0是否支持chunked transfer传输编码？ {#section_pt3_knx_wdb .section}

支持。

